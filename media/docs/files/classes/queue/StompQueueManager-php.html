<html><head><title>D:\Software\postActiv\classes\queue\StompQueueManager.php - postActiv</title><link rel="stylesheet" type="text/css" href="../../../styles/main.css"><script language=JavaScript src="../../../javascript/main.js"></script></head><body class="FramedContentPage" onLoad="NDOnLoad()"><script language=JavaScript><!--
if (browserType) {document.write("<div class=" + browserType + ">");if (browserVer) {document.write("<div class=" + browserVer + ">"); }}// --></script>

<!--  Generated by Natural Docs, version 1.4 -->
<!--  http://www.naturaldocs.org  -->

<!-- saved from url=(0026)http://www.naturaldocs.org -->




<div id=Content><div class="CFile"><div class=CTopic id=MainTopic><h1 class=CTitle><a name="StompQueueManager.php"></a>StompQueueManager.php</h1><div class=CBody><!--START_ND_SUMMARY--><div class=Summary><div class=STitle>Summary</div><div class=SBorder><table border=0 cellspacing=0 cellpadding=0 class=STable><tr class="SMain"><td class=SEntry><a href="#StompQueueManager.php" >StompQueueManager.php</a></td><td class=SDescription></td></tr><tr class="SClass"><td class=SEntry><a href="#StompQueueManager" >StompQueueManager</a></td><td class=SDescription></td></tr><tr class="SFunction SIndent1 SMarked"><td class=SEntry><a href="#StompQueueManager.__construct" id=link1 onMouseOver="ShowTip(event, 'tt1', 'link1')" onMouseOut="HideTip('tt1')">__construct</a></td><td class=SDescription>Class constructor</td></tr><tr class="SFunction SIndent1"><td class=SEntry><a href="#StompQueueManager._connect" id=link2 onMouseOver="ShowTip(event, 'tt2', 'link2')" onMouseOut="HideTip('tt2')">_connect</a></td><td class=SDescription>Lazy open a single connection to Stomp queue server. </td></tr><tr class="SFunction SIndent1 SMarked"><td class=SEntry><a href="#StompQueueManager._connectAll" id=link3 onMouseOver="ShowTip(event, 'tt3', 'link3')" onMouseOut="HideTip('tt3')">_connectAll</a></td><td class=SDescription>Lazy open connections to all Stomp servers, if in manual failover mode. </td></tr><tr class="SFunction SIndent1"><td class=SEntry><a href="#StompQueueManager._doConnect" id=link4 onMouseOver="ShowTip(event, 'tt4', 'link4')" onMouseOut="HideTip('tt4')">_doConnect</a></td><td class=SDescription>Handles connecting to a single STOMP server</td></tr><tr class="SFunction SIndent1 SMarked"><td class=SEntry><a href="#StompQueueManager._doEnqueue" id=link5 onMouseOver="ShowTip(event, 'tt5', 'link5')" onMouseOut="HideTip('tt5')">_doEnqueue</a></td><td class=SDescription>Saves a notice object reference into the queue item table on the given connection.</td></tr><tr class="SFunction SIndent1"><td class=SEntry><a href="#StompQueueManager._reconnect" id=link6 onMouseOver="ShowTip(event, 'tt6', 'link6')" onMouseOut="HideTip('tt6')">_reconnect</a></td><td class=SDescription>Attempt to manually reconnect to the STOMP server for the given slot. </td></tr><tr class="SFunction SIndent1 SMarked"><td class=SEntry><a href="#StompQueueManager.multiSite" id=link7 onMouseOver="ShowTip(event, 'tt7', 'link7')" onMouseOut="HideTip('tt7')">multiSite</a></td><td class=SDescription>Tell the i/o master we only need a single instance to cover all sites running in this process.</td></tr><tr class="SFunction SIndent1"><td class=SEntry><a href="#StompQueueManager.sendControlSignal" id=link8 onMouseOver="ShowTip(event, 'tt8', 'link8')" onMouseOut="HideTip('tt8')">sendControlSignal</a></td><td class=SDescription>Optional; ping any running queue handler daemons with a notification such as announcing a new site to handle or requesting clean shutdown. </td></tr><tr class="SFunction SIndent1 SMarked"><td class=SEntry><a href="#StompQueueManager.enqueue" id=link9 onMouseOver="ShowTip(event, 'tt9', 'link9')" onMouseOut="HideTip('tt9')">enqueue</a></td><td class=SDescription>Saves an object into the queue item table.</td></tr><tr class="SFunction SIndent1"><td class=SEntry><a href="#StompQueueManager.isPersistent" id=link10 onMouseOver="ShowTip(event, 'tt10', 'link10')" onMouseOut="HideTip('tt10')">isPersistent</a></td><td class=SDescription>Determine whether messages to this queue should be marked as persistent. </td></tr><tr class="SFunction SIndent1 SMarked"><td class=SEntry><a href="#StompQueueManager.getSockets" id=link11 onMouseOver="ShowTip(event, 'tt11', 'link11')" onMouseOut="HideTip('tt11')">getSockets</a></td><td class=SDescription>Send any sockets we&rsquo;re listening on to the IO manager to wait for input.</td></tr><tr class="SFunction SIndent1"><td class=SEntry><a href="#StompQueueManager.connectionFromSocket" id=link12 onMouseOver="ShowTip(event, 'tt12', 'link12')" onMouseOut="HideTip('tt12')">connectionFromSocket</a></td><td class=SDescription>Get the Stomp connection object associated with the given socket.</td></tr><tr class="SFunction SIndent1 SMarked"><td class=SEntry><a href="#StompQueueManager.handleInput" id=link13 onMouseOver="ShowTip(event, 'tt13', 'link13')" onMouseOut="HideTip('tt13')">handleInput</a></td><td class=SDescription>We&rsquo;ve got input to handle on our socket!&nbsp; </td></tr><tr class="SFunction SIndent1"><td class=SEntry><a href="#StompQueueManager.idle" id=link14 onMouseOver="ShowTip(event, 'tt14', 'link14')" onMouseOut="HideTip('tt14')">idle</a></td><td class=SDescription>Attempt to reconnect in background if we lost a connection.</td></tr><tr class="SFunction SIndent1 SMarked"><td class=SEntry><a href="#StompQueueManager.start" id=link15 onMouseOver="ShowTip(event, 'tt15', 'link15')" onMouseOut="HideTip('tt15')">start</a></td><td class=SDescription>Initialize our connection and subscribe to all the queues we&rsquo;re going to need to handle... </td></tr><tr class="SFunction SIndent1"><td class=SEntry><a href="#StompQueueManager.finish" id=link16 onMouseOver="ShowTip(event, 'tt16', 'link16')" onMouseOut="HideTip('tt16')">finish</a></td><td class=SDescription>Close out any active connections.</td></tr><tr class="SFunction SIndent1 SMarked"><td class=SEntry><a href="#StompQueueManager.doSubscribe" id=link17 onMouseOver="ShowTip(event, 'tt17', 'link17')" onMouseOut="HideTip('tt17')">doSubscribe</a></td><td class=SDescription>Set up all our raw queue subscriptions on the given connection</td></tr><tr class="SFunction SIndent1"><td class=SEntry><a href="#StompQueueManager.subscriptions" id=link18 onMouseOver="ShowTip(event, 'tt18', 'link18')" onMouseOut="HideTip('tt18')">subscriptions</a></td><td class=SDescription>Grab a full list of stomp-side queue subscriptions. </td></tr><tr class="SFunction SIndent1 SMarked"><td class=SEntry><a href="#StompQueueManager.handleItem" id=link19 onMouseOver="ShowTip(event, 'tt19', 'link19')" onMouseOut="HideTip('tt19')">handleItem</a></td><td class=SDescription>Handle and acknowledge an event that&rsquo;s come in through a queue.</td></tr><tr class="SFunction SIndent1"><td class=SEntry><a href="#StompQueueManager.isDeadLetter" id=link20 onMouseOver="ShowTip(event, 'tt20', 'link20')" onMouseOut="HideTip('tt20')">isDeadLetter</a></td><td class=SDescription>Check if a redelivered message has been run through enough that we&rsquo;re going to give up on it.</td></tr><tr class="SFunction SIndent1 SMarked"><td class=SEntry><a href="#StompQueueManager.incDeliveryCount" id=link21 onMouseOver="ShowTip(event, 'tt21', 'link21')" onMouseOut="HideTip('tt21')">incDeliveryCount</a></td><td class=SDescription>Update count of times we&rsquo;ve re-encountered this message recently, triggered when we get a message marked as &lsquo;redelivered&rsquo;.</td></tr><tr class="SFunction SIndent1"><td class=SEntry><a href="#StompQueueManager.handleControlSignal" id=link22 onMouseOver="ShowTip(event, 'tt22', 'link22')" onMouseOut="HideTip('tt22')">handleControlSignal</a></td><td class=SDescription>Process a control signal broadcast.</td></tr><tr class="SFunction SIndent1 SMarked"><td class=SEntry><a href="#StompQueueManager.switchSite" id=link23 onMouseOver="ShowTip(event, 'tt23', 'link23')" onMouseOut="HideTip('tt23')">switchSite</a></td><td class=SDescription>Switch site, if necessary, and reset current handler assignments</td></tr><tr class="SFunction SIndent1"><td class=SEntry><a href="#StompQueueManager.updateSiteConfig" id=link24 onMouseOver="ShowTip(event, 'tt24', 'link24')" onMouseOut="HideTip('tt24')">updateSiteConfig</a></td><td class=SDescription>(Re)load runtime configuration for a given site by nickname, triggered by a broadcast to the &lsquo;statusnet-control&rsquo; topic.</td></tr><tr class="SFunction SIndent1 SMarked"><td class=SEntry><a href="#StompQueueManager.queueName" id=link25 onMouseOver="ShowTip(event, 'tt25', 'link25')" onMouseOut="HideTip('tt25')">queueName</a></td><td class=SDescription>Combines the queue_basename from configuration with the group name for this queue to give eg:</td></tr><tr class="SFunction SIndent1"><td class=SEntry><a href="#StompQueueManager.breakoutMode" id=link26 onMouseOver="ShowTip(event, 'tt26', 'link26')" onMouseOut="HideTip('tt26')">breakoutMode</a></td><td class=SDescription>Get the breakout mode for the given queue on the current site.</td></tr><tr class="SFunction SIndent1 SMarked"><td class=SEntry><a href="#StompQueueManager.begin" id=link27 onMouseOver="ShowTip(event, 'tt27', 'link27')" onMouseOut="HideTip('tt27')">begin</a></td><td class=SDescription></td></tr><tr class="SFunction SIndent1"><td class=SEntry><a href="#StompQueueManager.ack" id=link28 onMouseOver="ShowTip(event, 'tt28', 'link28')" onMouseOut="HideTip('tt28')">ack</a></td><td class=SDescription></td></tr><tr class="SFunction SIndent1 SMarked"><td class=SEntry><a href="#StompQueueManager.commit" id=link29 onMouseOver="ShowTip(event, 'tt29', 'link29')" onMouseOut="HideTip('tt29')">commit</a></td><td class=SDescription>Commit a STOMP transaction</td></tr><tr class="SFunction SIndent1"><td class=SEntry><a href="#StompQueueManager.rollback" id=link30 onMouseOver="ShowTip(event, 'tt30', 'link30')" onMouseOut="HideTip('tt30')">rollback</a></td><td class=SDescription>Rollback a STOMP transaction</td></tr></table></div></div><!--END_ND_SUMMARY--></div></div></div>

<div class="CClass"><div class=CTopic><h2 class=CTitle><a name="StompQueueManager"></a>StompQueueManager</h2><div class=CBody><h4 class=CHeading>Varibales</h4><ul><li>protected $servers;</li><li>protected $username;</li><li>protected $password;</li><li>protected $base;</li><li>protected $control;</li><li>protected $useTransactions;</li><li>protected $useAcks;</li><li>protected $sites = array();</li><li>protected $subscriptions = array();</li><li>protected $cons = array(); // all open connections</li><li>protected $disconnect = array();</li><li>protected $transaction = array();</li><li>protected $transactionCount = array();</li><li>protected $defaultIdx = 0;</li></ul><!--START_ND_SUMMARY--><div class=Summary><div class=STitle>Summary</div><div class=SBorder><table border=0 cellspacing=0 cellpadding=0 class=STable><tr class="SFunction"><td class=SEntry><a href="#StompQueueManager.__construct" id=link31 onMouseOver="ShowTip(event, 'tt1', 'link31')" onMouseOut="HideTip('tt1')">__construct</a></td><td class=SDescription>Class constructor</td></tr><tr class="SFunction SMarked"><td class=SEntry><a href="#StompQueueManager._connect" id=link32 onMouseOver="ShowTip(event, 'tt2', 'link32')" onMouseOut="HideTip('tt2')">_connect</a></td><td class=SDescription>Lazy open a single connection to Stomp queue server. </td></tr><tr class="SFunction"><td class=SEntry><a href="#StompQueueManager._connectAll" id=link33 onMouseOver="ShowTip(event, 'tt3', 'link33')" onMouseOut="HideTip('tt3')">_connectAll</a></td><td class=SDescription>Lazy open connections to all Stomp servers, if in manual failover mode. </td></tr><tr class="SFunction SMarked"><td class=SEntry><a href="#StompQueueManager._doConnect" id=link34 onMouseOver="ShowTip(event, 'tt4', 'link34')" onMouseOut="HideTip('tt4')">_doConnect</a></td><td class=SDescription>Handles connecting to a single STOMP server</td></tr><tr class="SFunction"><td class=SEntry><a href="#StompQueueManager._doEnqueue" id=link35 onMouseOver="ShowTip(event, 'tt5', 'link35')" onMouseOut="HideTip('tt5')">_doEnqueue</a></td><td class=SDescription>Saves a notice object reference into the queue item table on the given connection.</td></tr><tr class="SFunction SMarked"><td class=SEntry><a href="#StompQueueManager._reconnect" id=link36 onMouseOver="ShowTip(event, 'tt6', 'link36')" onMouseOut="HideTip('tt6')">_reconnect</a></td><td class=SDescription>Attempt to manually reconnect to the STOMP server for the given slot. </td></tr><tr class="SFunction"><td class=SEntry><a href="#StompQueueManager.multiSite" id=link37 onMouseOver="ShowTip(event, 'tt7', 'link37')" onMouseOut="HideTip('tt7')">multiSite</a></td><td class=SDescription>Tell the i/o master we only need a single instance to cover all sites running in this process.</td></tr><tr class="SFunction SMarked"><td class=SEntry><a href="#StompQueueManager.sendControlSignal" id=link38 onMouseOver="ShowTip(event, 'tt8', 'link38')" onMouseOut="HideTip('tt8')">sendControlSignal</a></td><td class=SDescription>Optional; ping any running queue handler daemons with a notification such as announcing a new site to handle or requesting clean shutdown. </td></tr><tr class="SFunction"><td class=SEntry><a href="#StompQueueManager.enqueue" id=link39 onMouseOver="ShowTip(event, 'tt9', 'link39')" onMouseOut="HideTip('tt9')">enqueue</a></td><td class=SDescription>Saves an object into the queue item table.</td></tr><tr class="SFunction SMarked"><td class=SEntry><a href="#StompQueueManager.isPersistent" id=link40 onMouseOver="ShowTip(event, 'tt10', 'link40')" onMouseOut="HideTip('tt10')">isPersistent</a></td><td class=SDescription>Determine whether messages to this queue should be marked as persistent. </td></tr><tr class="SFunction"><td class=SEntry><a href="#StompQueueManager.getSockets" id=link41 onMouseOver="ShowTip(event, 'tt11', 'link41')" onMouseOut="HideTip('tt11')">getSockets</a></td><td class=SDescription>Send any sockets we&rsquo;re listening on to the IO manager to wait for input.</td></tr><tr class="SFunction SMarked"><td class=SEntry><a href="#StompQueueManager.connectionFromSocket" id=link42 onMouseOver="ShowTip(event, 'tt12', 'link42')" onMouseOut="HideTip('tt12')">connectionFromSocket</a></td><td class=SDescription>Get the Stomp connection object associated with the given socket.</td></tr><tr class="SFunction"><td class=SEntry><a href="#StompQueueManager.handleInput" id=link43 onMouseOver="ShowTip(event, 'tt13', 'link43')" onMouseOut="HideTip('tt13')">handleInput</a></td><td class=SDescription>We&rsquo;ve got input to handle on our socket!&nbsp; </td></tr><tr class="SFunction SMarked"><td class=SEntry><a href="#StompQueueManager.idle" id=link44 onMouseOver="ShowTip(event, 'tt14', 'link44')" onMouseOut="HideTip('tt14')">idle</a></td><td class=SDescription>Attempt to reconnect in background if we lost a connection.</td></tr><tr class="SFunction"><td class=SEntry><a href="#StompQueueManager.start" id=link45 onMouseOver="ShowTip(event, 'tt15', 'link45')" onMouseOut="HideTip('tt15')">start</a></td><td class=SDescription>Initialize our connection and subscribe to all the queues we&rsquo;re going to need to handle... </td></tr><tr class="SFunction SMarked"><td class=SEntry><a href="#StompQueueManager.finish" id=link46 onMouseOver="ShowTip(event, 'tt16', 'link46')" onMouseOut="HideTip('tt16')">finish</a></td><td class=SDescription>Close out any active connections.</td></tr><tr class="SFunction"><td class=SEntry><a href="#StompQueueManager.doSubscribe" id=link47 onMouseOver="ShowTip(event, 'tt17', 'link47')" onMouseOut="HideTip('tt17')">doSubscribe</a></td><td class=SDescription>Set up all our raw queue subscriptions on the given connection</td></tr><tr class="SFunction SMarked"><td class=SEntry><a href="#StompQueueManager.subscriptions" id=link48 onMouseOver="ShowTip(event, 'tt18', 'link48')" onMouseOut="HideTip('tt18')">subscriptions</a></td><td class=SDescription>Grab a full list of stomp-side queue subscriptions. </td></tr><tr class="SFunction"><td class=SEntry><a href="#StompQueueManager.handleItem" id=link49 onMouseOver="ShowTip(event, 'tt19', 'link49')" onMouseOut="HideTip('tt19')">handleItem</a></td><td class=SDescription>Handle and acknowledge an event that&rsquo;s come in through a queue.</td></tr><tr class="SFunction SMarked"><td class=SEntry><a href="#StompQueueManager.isDeadLetter" id=link50 onMouseOver="ShowTip(event, 'tt20', 'link50')" onMouseOut="HideTip('tt20')">isDeadLetter</a></td><td class=SDescription>Check if a redelivered message has been run through enough that we&rsquo;re going to give up on it.</td></tr><tr class="SFunction"><td class=SEntry><a href="#StompQueueManager.incDeliveryCount" id=link51 onMouseOver="ShowTip(event, 'tt21', 'link51')" onMouseOut="HideTip('tt21')">incDeliveryCount</a></td><td class=SDescription>Update count of times we&rsquo;ve re-encountered this message recently, triggered when we get a message marked as &lsquo;redelivered&rsquo;.</td></tr><tr class="SFunction SMarked"><td class=SEntry><a href="#StompQueueManager.handleControlSignal" id=link52 onMouseOver="ShowTip(event, 'tt22', 'link52')" onMouseOut="HideTip('tt22')">handleControlSignal</a></td><td class=SDescription>Process a control signal broadcast.</td></tr><tr class="SFunction"><td class=SEntry><a href="#StompQueueManager.switchSite" id=link53 onMouseOver="ShowTip(event, 'tt23', 'link53')" onMouseOut="HideTip('tt23')">switchSite</a></td><td class=SDescription>Switch site, if necessary, and reset current handler assignments</td></tr><tr class="SFunction SMarked"><td class=SEntry><a href="#StompQueueManager.updateSiteConfig" id=link54 onMouseOver="ShowTip(event, 'tt24', 'link54')" onMouseOut="HideTip('tt24')">updateSiteConfig</a></td><td class=SDescription>(Re)load runtime configuration for a given site by nickname, triggered by a broadcast to the &lsquo;statusnet-control&rsquo; topic.</td></tr><tr class="SFunction"><td class=SEntry><a href="#StompQueueManager.queueName" id=link55 onMouseOver="ShowTip(event, 'tt25', 'link55')" onMouseOut="HideTip('tt25')">queueName</a></td><td class=SDescription>Combines the queue_basename from configuration with the group name for this queue to give eg:</td></tr><tr class="SFunction SMarked"><td class=SEntry><a href="#StompQueueManager.breakoutMode" id=link56 onMouseOver="ShowTip(event, 'tt26', 'link56')" onMouseOut="HideTip('tt26')">breakoutMode</a></td><td class=SDescription>Get the breakout mode for the given queue on the current site.</td></tr><tr class="SFunction"><td class=SEntry><a href="#StompQueueManager.begin" id=link57 onMouseOver="ShowTip(event, 'tt27', 'link57')" onMouseOut="HideTip('tt27')">begin</a></td><td class=SDescription></td></tr><tr class="SFunction SMarked"><td class=SEntry><a href="#StompQueueManager.ack" id=link58 onMouseOver="ShowTip(event, 'tt28', 'link58')" onMouseOut="HideTip('tt28')">ack</a></td><td class=SDescription></td></tr><tr class="SFunction"><td class=SEntry><a href="#StompQueueManager.commit" id=link59 onMouseOver="ShowTip(event, 'tt29', 'link59')" onMouseOut="HideTip('tt29')">commit</a></td><td class=SDescription>Commit a STOMP transaction</td></tr><tr class="SFunction SMarked"><td class=SEntry><a href="#StompQueueManager.rollback" id=link60 onMouseOver="ShowTip(event, 'tt30', 'link60')" onMouseOut="HideTip('tt30')">rollback</a></td><td class=SDescription>Rollback a STOMP transaction</td></tr></table></div></div><!--END_ND_SUMMARY--></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="StompQueueManager.__construct"></a>__construct</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td>function __construct()</td></tr></table></blockquote><p>Class constructor</p></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="StompQueueManager._connect"></a>_connect</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td>protected function _connect()</td></tr></table></blockquote><p>Lazy open a single connection to Stomp queue server.&nbsp; If multiple servers are configured, we let the Stomp client library worry about finding a working connection among them.</p></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="StompQueueManager._connectAll"></a>_connectAll</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td>protected function _connectAll()</td></tr></table></blockquote><p>Lazy open connections to all Stomp servers, if in manual failover mode.&nbsp; This means the queue servers don&rsquo;t speak to each other, so we have to listen to all of them to make sure we get all events.</p></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="StompQueueManager._doConnect"></a>_doConnect</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>protected function _doConnect(</td><td class=PParameter nowrap>$server</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote><p>Handles connecting to a single STOMP server</p><h4 class=CHeading>Parameters</h4><ul><li>$server</li></ul><h4 class=CHeading>Returns</h4><ul><li>$con</li></ul><h4 class=CHeading>Error State</h4><ul><li>Throws a ServerException if unable to connect</li></ul></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="StompQueueManager._doEnqueue"></a>_doEnqueue</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>protected function _doEnqueue(</td><td class=PParameter nowrap>$object,</td><td class=PDefaultValuePrefix>&nbsp;&nbsp;</td><td class=PDefaultValue width=100%></td></tr><tr><td></td><td class=PParameter nowrap>$queue,</td><td class=PDefaultValuePrefix>&nbsp;&nbsp;</td><td class=PDefaultValue width=100%></td></tr><tr><td></td><td class=PParameter nowrap>$idx,</td><td class=PDefaultValuePrefix>&nbsp;&nbsp;</td><td class=PDefaultValue width=100%></td></tr><tr><td></td><td class=PParameter nowrap>$siteNickname</td><td class=PDefaultValuePrefix>&nbsp;=&nbsp;</td><td class=PDefaultValue width=100%>null</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote><p>Saves a notice object reference into the queue item table on the given connection.</p><h4 class=CHeading>Returns</h4><ul><li>boolean true on success</li></ul><h4 class=CHeading>Error State</h4><ul><li>throws StompException on connection or send error</li></ul></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="StompQueueManager._reconnect"></a>_reconnect</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>protected function _reconnect(</td><td class=PParameter nowrap>$idx</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote><p>Attempt to manually reconnect to the STOMP server for the given slot.&nbsp; If successful, set up our subscriptions on it.</p><h4 class=CHeading>Parameters</h4><ul><li>$idx</li></ul><h4 class=CHeading>Error States</h4><ul><li>If the connection fails in an error state that is caught and logged</li></ul></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="StompQueueManager.multiSite"></a>multiSite</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td>public static function multiSite()</td></tr></table></blockquote><p>Tell the i/o master we only need a single instance to cover all sites running in this process.</p></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="StompQueueManager.sendControlSignal"></a>sendControlSignal</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>public function sendControlSignal(</td><td class=PParameter nowrap>$event,</td><td class=PDefaultValuePrefix>&nbsp;&nbsp;</td><td class=PDefaultValue width=100%></td></tr><tr><td></td><td class=PParameter nowrap>$param</td><td class=PDefaultValuePrefix>&nbsp;=&nbsp;</td><td class=PDefaultValue width=100%>''</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote><p>Optional; ping any running queue handler daemons with a notification such as announcing a new site to handle or requesting clean shutdown.&nbsp; This avoids having to restart all the daemons manually to update configs and such.</p><p>Currently only relevant for multi-site queue managers such as STOMP.</p><h4 class=CHeading>Parameters</h4><ul><li>string $event - event key</li><li>string $param - optional parameter to append to key</li></ul><h4 class=CHeading>Returns</h4><ul><li>boolean success</li></ul></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="StompQueueManager.enqueue"></a>enqueue</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>public function enqueue(</td><td class=PParameter nowrap>$object,</td><td class=PDefaultValuePrefix>&nbsp;&nbsp;</td><td class=PDefaultValue width=100%></td></tr><tr><td></td><td class=PParameter nowrap>$queue,</td><td class=PDefaultValuePrefix>&nbsp;&nbsp;</td><td class=PDefaultValue width=100%></td></tr><tr><td></td><td class=PParameter nowrap>$siteNickname</td><td class=PDefaultValuePrefix>&nbsp;=&nbsp;</td><td class=PDefaultValue width=100%>null</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote><p>Saves an object into the queue item table.</p><h4 class=CHeading>Parameters</h4><ul><li>mixed $object</li><li>string $queue</li><li>string $siteNickname optional override to drop into another site&rsquo;s queue</li></ul><h4 class=CHeading>Returns</h4><ul><li>boolean true on success</li></ul><h4 class=CHeading>Error State</h4><ul><li>StompException on connection or send error</li></ul></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="StompQueueManager.isPersistent"></a>isPersistent</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>protected function isPersistent(</td><td class=PParameter nowrap>$queue</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote><p>Determine whether messages to this queue should be marked as persistent.&nbsp; Actual persistent storage depends on the queue server&rsquo;s configuration.</p><h4 class=CHeading>Parameters</h4><p>string $queue</p><h4 class=CHeading>Returns</h4><ul><li>bool</li></ul></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="StompQueueManager.getSockets"></a>getSockets</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td>public function getSockets()</td></tr></table></blockquote><p>Send any sockets we&rsquo;re listening on to the IO manager to wait for input.</p><h4 class=CHeading>Returns</h4><ul><li>array of resources</li></ul></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="StompQueueManager.connectionFromSocket"></a>connectionFromSocket</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>protected function connectionFromSocket(</td><td class=PParameter nowrap>$socket</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote><p>Get the Stomp connection object associated with the given socket.</p><p>Parameters</p><ul><li>resource $socket</li></ul><h4 class=CHeading>Returns</h4><ul><li>int - index into connections list</li></ul><h4 class=CHeading>Error State</h4><ul><li>Throws an exception if the socket doesn&rsquo;t have an associated STOMP connection</li></ul></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="StompQueueManager.handleInput"></a>handleInput</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>public function handleInput(</td><td class=PParameter nowrap>$socket</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote><p>We&rsquo;ve got input to handle on our socket!&nbsp; Read any waiting Stomp frame(s) and process them.</p><h4 class=CHeading>Parameters</h4><ul><li>resource $socket</li></ul><h4 class=CHeading>Returns</h4><ul><li>boolean ok on success</li></ul><h4 class=CHeading>Error State</h4><ul><li>raises a StompException if the connection is lost</li></ul></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="StompQueueManager.idle"></a>idle</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td>function idle()</td></tr></table></blockquote><p>Attempt to reconnect in background if we lost a connection.</p></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="StompQueueManager.start"></a>start</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>public function start(</td><td class=PParameter nowrap>$master</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote><p>Initialize our connection and subscribe to all the queues we&rsquo;re going to need to handle...&nbsp; If multiple queue servers are configured for failover, we&rsquo;ll listen to all of them.</p><p>Side effects: in multi-site mode, may reset site configuration.</p><h4 class=CHeading>Parameters</h4><ul><li>IoMaster $master process/event controller</li></ul><h4 class=CHeading>Returns</h4><ul><li>bool return false on failure</li></ul></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="StompQueueManager.finish"></a>finish</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td>public function finish()</td></tr></table></blockquote><p>Close out any active connections.</p><p>@return bool return false on failure</p></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="StompQueueManager.doSubscribe"></a>doSubscribe</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>protected function doSubscribe(</td><td class=PType nowrap>LiberalStomp&nbsp;</td><td class=PParameter nowrap>$con</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote><p>Set up all our raw queue subscriptions on the given connection</p><h4 class=CHeading>Parameters</h4><ul><li>LiberalStomp $con</li></ul></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="StompQueueManager.subscriptions"></a>subscriptions</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td>protected function subscriptions()</td></tr></table></blockquote><p>Grab a full list of stomp-side queue subscriptions.&nbsp; Will include:</p><ul><li>control broadcast channel</li><li>shared group queues for active groups</li><li>per-handler and per-site breakouts from $config[&lsquo;queue&rsquo;][&lsquo;breakout&rsquo;] that are rooted in the active groups.</li></ul><h4 class=CHeading>Returns</h4><ul><li>array of strings</li></ul></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="StompQueueManager.handleItem"></a>handleItem</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>protected function handleItem(</td><td class=PParameter nowrap>$frame</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote><p>Handle and acknowledge an event that&rsquo;s come in through a queue.</p><p>If the queue handler reports failure, the message is requeued for later.&nbsp; Missing notices or handler classes will drop the message.</p><p>Side effects: in multi-site mode, may reset site configuration to match the site that queued the event.</p><h4 class=CHeading>Parameters</h4><ul><li>StompFrame $frame</li></ul><h4 class=CHeading>Returns</h4><ul><li>bool success</li></ul></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="StompQueueManager.isDeadLetter"></a>isDeadLetter</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>protected function isDeadLetter(</td><td class=PParameter nowrap>$frame,</td></tr><tr><td></td><td class=PParameter nowrap>$message</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote><p>Check if a redelivered message has been run through enough that we&rsquo;re going to give up on it.</p><h4 class=CHeading>Parameters</h4><ul><li>StompFrame $frame</li><li>array $message unserialized message body</li></ul><p>Returns</p><ul><li>boolean true if we should discard</li></ul></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="StompQueueManager.incDeliveryCount"></a>incDeliveryCount</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>function incDeliveryCount(</td><td class=PParameter nowrap>$msgId</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote><p>Update count of times we&rsquo;ve re-encountered this message recently, triggered when we get a message marked as &lsquo;redelivered&rsquo;.</p><p>Requires a CLI-friendly cache configuration.</p><p>@param string $msgId message-id header from message @return int number of retries recorded</p></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="StompQueueManager.handleControlSignal"></a>handleControlSignal</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>protected function handleControlSignal(</td><td class=PParameter nowrap>$idx,</td></tr><tr><td></td><td class=PParameter nowrap>$frame</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote><p>Process a control signal broadcast.</p><h4 class=CHeading>Parameters</h4><ul><li>int $idx connection index</li><li>array $frame Stomp frame</li></ul><h4 class=CHeading>Returns</h4><ul><li>bool true to continue; false to stop further processing.</li></ul></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="StompQueueManager.switchSite"></a>switchSite</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>function switchSite(</td><td class=PParameter nowrap>$site</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote><p>Switch site, if necessary, and reset current handler assignments</p><h4 class=CHeading>Parameters</h4><ul><li>string $site</li></ul></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="StompQueueManager.updateSiteConfig"></a>updateSiteConfig</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>protected function updateSiteConfig(</td><td class=PParameter nowrap>$nickname</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote><p>(Re)load runtime configuration for a given site by nickname, triggered by a broadcast to the &lsquo;statusnet-control&rsquo; topic.</p><p>Configuration changes in database should update, but config files might not.</p><p>@param array $frame Stomp frame @return bool true to continue; false to stop further processing.</p></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="StompQueueManager.queueName"></a>queueName</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>protected function queueName(</td><td class=PParameter nowrap>$queue</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote><p>Combines the queue_basename from configuration with the group name for this queue to give eg:</p><ul><li>/queue/statusnet/main</li><li>/queue/statusnet/main/distrib</li><li>/queue/statusnet/xmpp/xmppout/site01</li></ul><h4 class=CHeading>Parameters</h4><ul><li>string $queue</li></ul><h4 class=CHeading>Returns</h4><ul><li>string</li></ul></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="StompQueueManager.breakoutMode"></a>breakoutMode</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>protected function breakoutMode(</td><td class=PParameter nowrap>$queue</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote><p>Get the breakout mode for the given queue on the current site.</p><p>@param string $queue @return string one of &lsquo;shared&rsquo;, &lsquo;handler&rsquo;, &lsquo;site&rsquo;</p></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="StompQueueManager.begin"></a>begin</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>protected function begin(</td><td class=PParameter nowrap>$idx</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="StompQueueManager.ack"></a>ack</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>protected function ack(</td><td class=PParameter nowrap>$idx,</td></tr><tr><td></td><td class=PParameter nowrap>$frame</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="StompQueueManager.commit"></a>commit</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>protected function commit(</td><td class=PParameter nowrap>$idx</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote><p>Commit a STOMP transaction</p><h4 class=CHeading>Parameters</h4><table border=0 cellspacing=0 cellpadding=0 class=CDescriptionList><tr><td class=CDLEntry>int $idx</td><td class=CDLDescription>ID of transaction</td></tr></table><h4 class=CHeading>Error State</h4><ul><li>An empty transaction state indicates we aren&rsquo;t in a transaction and will raise an exception.</li></ul></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="StompQueueManager.rollback"></a>rollback</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>protected function rollback(</td><td class=PParameter nowrap>$idx</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote><p>Rollback a STOMP transaction</p><h4 class=CHeading>Parameters</h4><ul><li>int $idx - id of transaction</li></ul><h4 class=CHeading>Error State</h4><ul><li>An empty transaction state indicates we aren&rsquo;t in a transaction and will raise an exception.</li></ul></div></div></div>

</div><!--Content-->



<!--START_ND_TOOLTIPS-->
<div class=CToolTip id="tt1"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td>function __construct()</td></tr></table></blockquote>Class constructor</div></div><div class=CToolTip id="tt2"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td>protected function _connect()</td></tr></table></blockquote>Lazy open a single connection to Stomp queue server. </div></div><div class=CToolTip id="tt3"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td>protected function _connectAll()</td></tr></table></blockquote>Lazy open connections to all Stomp servers, if in manual failover mode. </div></div><div class=CToolTip id="tt4"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>protected function _doConnect(</td><td class=PParameter nowrap>$server</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote>Handles connecting to a single STOMP server</div></div><div class=CToolTip id="tt5"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>protected function _doEnqueue(</td><td class=PParameter nowrap>$object,</td><td class=PDefaultValuePrefix>&nbsp;&nbsp;</td><td class=PDefaultValue width=100%></td></tr><tr><td></td><td class=PParameter nowrap>$queue,</td><td class=PDefaultValuePrefix>&nbsp;&nbsp;</td><td class=PDefaultValue width=100%></td></tr><tr><td></td><td class=PParameter nowrap>$idx,</td><td class=PDefaultValuePrefix>&nbsp;&nbsp;</td><td class=PDefaultValue width=100%></td></tr><tr><td></td><td class=PParameter nowrap>$siteNickname</td><td class=PDefaultValuePrefix>&nbsp;=&nbsp;</td><td class=PDefaultValue width=100%>null</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote>Saves a notice object reference into the queue item table on the given connection.</div></div><div class=CToolTip id="tt6"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>protected function _reconnect(</td><td class=PParameter nowrap>$idx</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote>Attempt to manually reconnect to the STOMP server for the given slot. </div></div><div class=CToolTip id="tt7"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td>public static function multiSite()</td></tr></table></blockquote>Tell the i/o master we only need a single instance to cover all sites running in this process.</div></div><div class=CToolTip id="tt8"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>public function sendControlSignal(</td><td class=PParameter nowrap>$event,</td><td class=PDefaultValuePrefix>&nbsp;&nbsp;</td><td class=PDefaultValue width=100%></td></tr><tr><td></td><td class=PParameter nowrap>$param</td><td class=PDefaultValuePrefix>&nbsp;=&nbsp;</td><td class=PDefaultValue width=100%>''</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote>Optional; ping any running queue handler daemons with a notification such as announcing a new site to handle or requesting clean shutdown. </div></div><div class=CToolTip id="tt9"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>public function enqueue(</td><td class=PParameter nowrap>$object,</td><td class=PDefaultValuePrefix>&nbsp;&nbsp;</td><td class=PDefaultValue width=100%></td></tr><tr><td></td><td class=PParameter nowrap>$queue,</td><td class=PDefaultValuePrefix>&nbsp;&nbsp;</td><td class=PDefaultValue width=100%></td></tr><tr><td></td><td class=PParameter nowrap>$siteNickname</td><td class=PDefaultValuePrefix>&nbsp;=&nbsp;</td><td class=PDefaultValue width=100%>null</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote>Saves an object into the queue item table.</div></div><div class=CToolTip id="tt10"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>protected function isPersistent(</td><td class=PParameter nowrap>$queue</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote>Determine whether messages to this queue should be marked as persistent. </div></div><div class=CToolTip id="tt11"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td>public function getSockets()</td></tr></table></blockquote>Send any sockets we&rsquo;re listening on to the IO manager to wait for input.</div></div><div class=CToolTip id="tt12"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>protected function connectionFromSocket(</td><td class=PParameter nowrap>$socket</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote>Get the Stomp connection object associated with the given socket.</div></div><div class=CToolTip id="tt13"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>public function handleInput(</td><td class=PParameter nowrap>$socket</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote>We&rsquo;ve got input to handle on our socket!&nbsp; </div></div><div class=CToolTip id="tt14"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td>function idle()</td></tr></table></blockquote>Attempt to reconnect in background if we lost a connection.</div></div><div class=CToolTip id="tt15"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>public function start(</td><td class=PParameter nowrap>$master</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote>Initialize our connection and subscribe to all the queues we&rsquo;re going to need to handle... </div></div><div class=CToolTip id="tt16"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td>public function finish()</td></tr></table></blockquote>Close out any active connections.</div></div><div class=CToolTip id="tt17"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>protected function doSubscribe(</td><td class=PType nowrap>LiberalStomp&nbsp;</td><td class=PParameter nowrap>$con</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote>Set up all our raw queue subscriptions on the given connection</div></div><div class=CToolTip id="tt18"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td>protected function subscriptions()</td></tr></table></blockquote>Grab a full list of stomp-side queue subscriptions. </div></div><div class=CToolTip id="tt19"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>protected function handleItem(</td><td class=PParameter nowrap>$frame</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote>Handle and acknowledge an event that&rsquo;s come in through a queue.</div></div><div class=CToolTip id="tt20"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>protected function isDeadLetter(</td><td class=PParameter nowrap>$frame,</td></tr><tr><td></td><td class=PParameter nowrap>$message</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote>Check if a redelivered message has been run through enough that we&rsquo;re going to give up on it.</div></div><div class=CToolTip id="tt21"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>function incDeliveryCount(</td><td class=PParameter nowrap>$msgId</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote>Update count of times we&rsquo;ve re-encountered this message recently, triggered when we get a message marked as &lsquo;redelivered&rsquo;.</div></div><div class=CToolTip id="tt22"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>protected function handleControlSignal(</td><td class=PParameter nowrap>$idx,</td></tr><tr><td></td><td class=PParameter nowrap>$frame</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote>Process a control signal broadcast.</div></div><div class=CToolTip id="tt23"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>function switchSite(</td><td class=PParameter nowrap>$site</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote>Switch site, if necessary, and reset current handler assignments</div></div><div class=CToolTip id="tt24"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>protected function updateSiteConfig(</td><td class=PParameter nowrap>$nickname</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote>(Re)load runtime configuration for a given site by nickname, triggered by a broadcast to the &lsquo;statusnet-control&rsquo; topic.</div></div><div class=CToolTip id="tt25"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>protected function queueName(</td><td class=PParameter nowrap>$queue</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote>Combines the queue_basename from configuration with the group name for this queue to give eg:</div></div><div class=CToolTip id="tt26"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>protected function breakoutMode(</td><td class=PParameter nowrap>$queue</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote>Get the breakout mode for the given queue on the current site.</div></div><div class=CToolTip id="tt27"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>protected function begin(</td><td class=PParameter nowrap>$idx</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote></div></div><div class=CToolTip id="tt28"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>protected function ack(</td><td class=PParameter nowrap>$idx,</td></tr><tr><td></td><td class=PParameter nowrap>$frame</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote></div></div><div class=CToolTip id="tt29"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>protected function commit(</td><td class=PParameter nowrap>$idx</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote>Commit a STOMP transaction</div></div><div class=CToolTip id="tt30"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>protected function rollback(</td><td class=PParameter nowrap>$idx</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote>Rollback a STOMP transaction</div></div><!--END_ND_TOOLTIPS-->

<script language=JavaScript><!--
if (browserType) {if (browserVer) {document.write("</div>"); }document.write("</div>");}// --></script></body></html>