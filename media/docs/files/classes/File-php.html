<html><head><title>B:\Software\postActiv\classes\File.php - postActiv</title><link rel="stylesheet" type="text/css" href="../../styles/main.css"><script language=JavaScript src="../../javascript/main.js"></script></head><body class="FramedContentPage" onLoad="NDOnLoad()"><script language=JavaScript><!--
if (browserType) {document.write("<div class=" + browserType + ">");if (browserVer) {document.write("<div class=" + browserVer + ">"); }}// --></script>

<!--  Generated by Natural Docs, version 1.4 -->
<!--  http://www.naturaldocs.org  -->

<!-- saved from url=(0026)http://www.naturaldocs.org -->




<div id=Content><div class="CFile"><div class=CTopic id=MainTopic><h1 class=CTitle><a name="File.php"></a>File.php</h1><div class=CBody><!--START_ND_SUMMARY--><div class=Summary><div class=STitle>Summary</div><div class=SBorder><table border=0 cellspacing=0 cellpadding=0 class=STable><tr class="SMain"><td class=SEntry><a href="#File.php" >File.php</a></td><td class=SDescription></td></tr><tr class="SSection"><td class=SEntry><a href="#File" >File</a></td><td class=SDescription>Table Definition for file</td></tr><tr class="SClass"><td class=SEntry><a href="#File" >File</a></td><td class=SDescription>A superclass containing the database representation of a file attatchment and the related interfaces.</td></tr><tr class="SFunction SIndent1 SMarked"><td class=SEntry><a href="#File.schemaDef" id=link1 onMouseOver="ShowTip(event, 'tt1', 'link1')" onMouseOut="HideTip('tt1')">schemaDef</a></td><td class=SDescription>Returns an array representing the database schema this class is interfacing with.</td></tr><tr class="SFunction SIndent1"><td class=SEntry><a href="#File.isProtected" id=link2 onMouseOver="ShowTip(event, 'tt2', 'link2')" onMouseOut="HideTip('tt2')">isProtected</a></td><td class=SDescription>Returns true/false whether the URL is considered &ldquo;protected&rdquo;.</td></tr><tr class="SFunction SIndent1 SMarked"><td class=SEntry><a href="#File.saveNew" id=link3 onMouseOver="ShowTip(event, 'tt3', 'link3')" onMouseOut="HideTip('tt3')">saveNew</a></td><td class=SDescription>Save a new file record.</td></tr><tr class="SFunction SIndent1"><td class=SEntry><a href="#File.saveFile" id=link4 onMouseOver="ShowTip(event, 'tt4', 'link4')" onMouseOut="HideTip('tt4')">saveFile</a></td><td class=SDescription>This slightly-misleadingly named function saves the File record to the database, for actually creating a new file properly, see saveNew.</td></tr><tr class="SFunction SIndent1 SMarked"><td class=SEntry><a href="#File.processNew" id=link5 onMouseOver="ShowTip(event, 'tt5', 'link5')" onMouseOut="HideTip('tt5')">processNew</a></td><td class=SDescription></td></tr><tr class="SFunction SIndent1"><td class=SEntry><a href="#File.respectsQuota" id=link6 onMouseOver="ShowTip(event, 'tt6', 'link6')" onMouseOut="HideTip('tt6')">respectsQuota</a></td><td class=SDescription>Tests whether a new upload respects the various quotas set in the instance configuration.</td></tr><tr class="SFunction SIndent1 SMarked"><td class=SEntry><a href="#File.getFilename" id=link7 onMouseOver="ShowTip(event, 'tt7', 'link7')" onMouseOut="HideTip('tt7')">getFilename</a></td><td class=SDescription>Returns the filename for the file represented by this File object.</td></tr><tr class="SFunction SIndent1"><td class=SEntry><a href="#File.getSize" id=link8 onMouseOver="ShowTip(event, 'tt8', 'link8')" onMouseOut="HideTip('tt8')">getSize</a></td><td class=SDescription>Returns the filesize as reported by the system for the file.</td></tr><tr class="SFunction SIndent1 SMarked"><td class=SEntry><a href="#File.filename" id=link9 onMouseOver="ShowTip(event, 'tt9', 'link9')" onMouseOut="HideTip('tt9')">filename</a></td><td class=SDescription>Construct the filename for a new File object. </td></tr><tr class="SFunction SIndent1"><td class=SEntry><a href="#File.guessMimeExtension" id=link10 onMouseOver="ShowTip(event, 'tt10', 'link10')" onMouseOut="HideTip('tt10')">guessMimeExtension</a></td><td class=SDescription>Attempt to determine the mime extension for the file represented by this File object. </td></tr><tr class="SFunction SIndent1 SMarked"><td class=SEntry><a href="#File.validFilename" id=link11 onMouseOver="ShowTip(event, 'tt11', 'link11')" onMouseOut="HideTip('tt11')">validFilename</a></td><td class=SDescription>Returns true/false whether the filename is a valid Linux filename.</td></tr><tr class="SFunction SIndent1"><td class=SEntry><a href="#File.tryFilename" id=link12 onMouseOver="ShowTip(event, 'tt12', 'link12')" onMouseOut="HideTip('tt12')">tryFilename</a></td><td class=SDescription></td></tr><tr class="SFunction SIndent1 SMarked"><td class=SEntry><a href="#File.path" id=link13 onMouseOver="ShowTip(event, 'tt13', 'link13')" onMouseOut="HideTip('tt13')">path</a></td><td class=SDescription>Constructs the path for a given $filename based on site configuration.</td></tr><tr class="SFunction SIndent1"><td class=SEntry><a href="#File.url" id=link14 onMouseOver="ShowTip(event, 'tt14', 'link14')" onMouseOut="HideTip('tt14')">url</a></td><td class=SDescription>Constructs the URL for a file entry.</td></tr><tr class="SFunction SIndent1 SMarked"><td class=SEntry><a href="#File.getEnclosure" id=link15 onMouseOver="ShowTip(event, 'tt15', 'link15')" onMouseOut="HideTip('tt15')">getEnclosure</a></td><td class=SDescription>Return the mime enclosure for a file.</td></tr><tr class="SFunction SIndent1"><td class=SEntry><a href="#File.hasThumbnail" id=link16 onMouseOver="ShowTip(event, 'tt16', 'link16')" onMouseOut="HideTip('tt16')">hasThumbnail</a></td><td class=SDescription>Returns true/false whether this attachment has a thumbnail on record.</td></tr><tr class="SFunction SIndent1 SMarked"><td class=SEntry><a href="#File.getThumbnail" id=link17 onMouseOver="ShowTip(event, 'tt17', 'link17')" onMouseOut="HideTip('tt17')">getThumbnail</a></td><td class=SDescription>Get the attachment&rsquo;s thumbnail record, if any. </td></tr><tr class="SFunction SIndent1"><td class=SEntry><a href="#File.getPath" id=link18 onMouseOver="ShowTip(event, 'tt18', 'link18')" onMouseOut="HideTip('tt18')">getPath</a></td><td class=SDescription>Returns the local filesystem path to a file we have stored locally.</td></tr><tr class="SFunction SIndent1 SMarked"><td class=SEntry><a href="#File.getAttachmentUrl" id=link19 onMouseOver="ShowTip(event, 'tt19', 'link19')" onMouseOut="HideTip('tt19')">getAttachmentUrl</a></td><td class=SDescription></td></tr><tr class="SFunction SIndent1"><td class=SEntry><a href="#File.getUrl" id=link20 onMouseOver="ShowTip(event, 'tt20', 'link20')" onMouseOut="HideTip('tt20')">getUrl</a></td><td class=SDescription></td></tr><tr class="SFunction SIndent1 SMarked"><td class=SEntry><a href="#File.getByUrl" id=link21 onMouseOver="ShowTip(event, 'tt21', 'link21')" onMouseOut="HideTip('tt21')">getByUrl</a></td><td class=SDescription>Retrieve a File object by looking up its URL.</td></tr><tr class="SFunction SIndent1"><td class=SEntry><a href="#File.getByHash" id=link22 onMouseOver="ShowTip(event, 'tt22', 'link22')" onMouseOut="HideTip('tt22')">getByHash</a></td><td class=SDescription>Retrieve a File object by looking up its hash.</td></tr><tr class="SFunction SIndent1 SMarked"><td class=SEntry><a href="#File.updateUrl" id=link23 onMouseOver="ShowTip(event, 'tt23', 'link23')" onMouseOut="HideTip('tt23')">updateUrl</a></td><td class=SDescription></td></tr><tr class="SFunction SIndent1"><td class=SEntry><a href="#File.blowCache" id=link24 onMouseOver="ShowTip(event, 'tt24', 'link24')" onMouseOut="HideTip('tt24')">blowCache</a></td><td class=SDescription>Blow the cache of notices that link to this URL</td></tr><tr class="SFunction SIndent1 SMarked"><td class=SEntry><a href="#File.stream" id=link25 onMouseOver="ShowTip(event, 'tt25', 'link25')" onMouseOut="HideTip('tt25')">stream</a></td><td class=SDescription>Stream of notices linking to this URL or attachment</td></tr><tr class="SFunction SIndent1"><td class=SEntry><a href="#File.noticeCount" id=link26 onMouseOver="ShowTip(event, 'tt26', 'link26')" onMouseOut="HideTip('tt26')">noticeCount</a></td><td class=SDescription>Returns how many notices use this attachment. </td></tr><tr class="SFunction SIndent1 SMarked"><td class=SEntry><a href="#File.isLocal" id=link27 onMouseOver="ShowTip(event, 'tt27', 'link27')" onMouseOut="HideTip('tt27')">isLocal</a></td><td class=SDescription>Returns whether we have a local copy of this file in the filesystem.</td></tr><tr class="SFunction SIndent1"><td class=SEntry><a href="#File.delete" id=link28 onMouseOver="ShowTip(event, 'tt28', 'link28')" onMouseOut="HideTip('tt28')">delete</a></td><td class=SDescription>Remove an attachment entry from the DB and the associated file if stored locally. </td></tr><tr class="SFunction SIndent1 SMarked"><td class=SEntry><a href="#File.getTitle" id=link29 onMouseOver="ShowTip(event, 'tt29', 'link29')" onMouseOut="HideTip('tt29')">getTitle</a></td><td class=SDescription>Retrieves the title of an attachment entry, or if none is set, the filename.</td></tr><tr class="SFunction SIndent1"><td class=SEntry><a href="#File.setTitle" id=link30 onMouseOver="ShowTip(event, 'tt30', 'link30')" onMouseOut="HideTip('tt30')">setTitle</a></td><td class=SDescription>Set the title of the attachment object.</td></tr><tr class="SFunction SIndent1 SMarked"><td class=SEntry><a href="#File.hashurl" id=link31 onMouseOver="ShowTip(event, 'tt31', 'link31')" onMouseOut="HideTip('tt31')">hashurl</a></td><td class=SDescription>Hash a URL provided using our given hash algorithm.</td></tr><tr class="SFunction SIndent1"><td class=SEntry><a href="#File.beforeSchemaUpdate" id=link32 onMouseOver="ShowTip(event, 'tt32', 'link32')" onMouseOut="HideTip('tt32')">beforeSchemaUpdate</a></td><td class=SDescription>This procedure contains the various integrity checks we need to perform for the attachment system specifically.</td></tr></table></div></div><!--END_ND_SUMMARY--></div></div></div>

<div class="CSection"><div class=CTopic><h2 class=CTitle><a name="File"></a>File</h2><div class=CBody><p>Table Definition for file</p><h4 class=CHeading>postActiv</h4><p>the micro-blogging software</p><h4 class=CHeading>Copyright</h4><p>Copyright &copy; 2016-2017, Maiyannah Bishop</p><h4 class=CHeading>Derived from code copyright various sources</h4><ul><li>GNU Social &copy; 2013-2016, Free Software Foundation, Inc</li><li>StatusNet &copy; 2008-2012, StatusNet, Inc</li></ul><h4 class=CHeading>License</h4><p>This program is free software: you can redistribute it and/or modify it under the terms of the GNU Affero General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.</p><p>This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.&nbsp;  See the GNU Affero General Public License for more details.</p><p>You should have received a copy of the GNU Affero General Public License along with this program.&nbsp;  If not, see <a href="http://www.gnu.org/licenses/" class=LURL target=_top>http://www.gnu.org/licenses/</a>.</p><p><a href="https://www.gnu.org/licenses/agpl.html" class=LURL target=_top>https://www.gnu.org/licenses/agpl.html</a></p><h4 class=CHeading>About</h4><p>A superclass containing the database representation of a file attatchment and the related interfaces.</p><p>Basically, this is things attached to a post.&nbsp;  One thing to note here is that it might not represent an actual attachment like an image or movie, it can also represent the metadata for a hyperlink to another website.</p><h4 class=CHeading>PHP version</h4><p>Tested with PHP 7</p><h4 class=CHeading>File Authors</h4><ul><li>Robin Millette <a href="#" onClick="location.href='mai' + 'lto:' + 'ro' + 'bin' + '@' + 'millet' + 'te.info'; return false;" class=LEMail>ro<span style="display: none">.nosp@m.</span>bin<span>@</span>millet<span style="display: none">.nosp@m.</span>te.info</a></li><li>Evan Prodromou</li><li>Zach Copley</li><li>Craig Andres <a href="#" onClick="location.href='mai' + 'lto:' + 'cand' + 'rews' + '@' + 'integral' + 'blue.com'; return false;" class=LEMail>cand<span style="display: none">.nosp@m.</span>rews<span>@</span>integral<span style="display: none">.nosp@m.</span>blue.com</a></li><li>Brenda Wallace <a href="#" onClick="location.href='mai' + 'lto:' + 'sh' + 'iny' + '@' + 'cpan' + '.org'; return false;" class=LEMail>sh<span style="display: none">.nosp@m.</span>iny<span>@</span>cpan<span style="display: none">.nosp@m.</span>.org</a></li><li>Brett Taylor <a href="#" onClick="location.href='mai' + 'lto:' + 'br' + 'ett' + '@' + 'webfroo' + 't.co.nz'; return false;" class=LEMail>br<span style="display: none">.nosp@m.</span>ett<span>@</span>webfroo<span style="display: none">.nosp@m.</span>t.co.nz</a></li><li>Brion Vibber <a href="#" onClick="location.href='mai' + 'lto:' + 'br' + 'ion' + '@' + 'pobo' + 'x.com'; return false;" class=LEMail>br<span style="display: none">.nosp@m.</span>ion<span>@</span>pobo<span style="display: none">.nosp@m.</span>x.com</a></li><li>Nick Holliday <a href="#" onClick="location.href='mai' + 'lto:' + 'n.g.ho' + 'lliday' + '@' + 'gmai' + 'l.com'; return false;" class=LEMail>n.g.ho<span style="display: none">.nosp@m.</span>lliday<span>@</span>gmai<span style="display: none">.nosp@m.</span>l.com</a></li><li>Siebrand Mazeland <a href="#" onClick="location.href='mai' + 'lto:' + 's.maz' + 'eland' + '@' + 'xs4a' + 'll.nl'; return false;" class=LEMail>s.maz<span style="display: none">.nosp@m.</span>eland<span>@</span>xs4a<span style="display: none">.nosp@m.</span>ll.nl</a></li><li>Mikael Nordfeldth <a href="#" onClick="location.href='mai' + 'lto:' + 'm' + 'mn' + '@' + 'hetha' + 'ne.se'; return false;" class=LEMail>m<span style="display: none">.nosp@m.</span>mn<span>@</span>hetha<span style="display: none">.nosp@m.</span>ne.se</a></li><li>Jean Baptiste Favre <a href="#" onClick="location.href='mai' + 'lto:' + 'git' + 'hub' + '@' + 'jbfav' + 're.org'; return false;" class=LEMail>git<span style="display: none">.nosp@m.</span>hub<span>@</span>jbfav<span style="display: none">.nosp@m.</span>re.org</a></li><li>Hannes Mannerheim <a href="#" onClick="location.href='mai' + 'lto:' + '' + 'h' + '@' + 'nnesman' + 'nerhe.im'; return false;" class=LEMail><span style="display: none">.nosp@m.</span>h<span>@</span>nnesman<span style="display: none">.nosp@m.</span>nerhe.im</a></li><li>Stephen Paul Weber <a href="#" onClick="location.href='mai' + 'lto:' + 'singp' + 'olyma' + '@' + 'singpol' + 'yma.net'; return false;" class=LEMail>singp<span style="display: none">.nosp@m.</span>olyma<span>@</span>singpol<span style="display: none">.nosp@m.</span>yma.net</a></li><li>Maiyannah Bishop <a href="#" onClick="location.href='mai' + 'lto:' + 'maiyanna' + 'h.bishop' + '@' + 'postac' + 'tiv.com'; return false;" class=LEMail>maiyanna<span style="display: none">.nosp@m.</span>h.bishop<span>@</span>postac<span style="display: none">.nosp@m.</span>tiv.com</a></li></ul><h4 class=CHeading>Web</h4><ul><li>postActiv  <a href="http://www.postactiv.com" class=LURL target=_top>http://www.postactiv.com</a></li><li>GNU social <a href="https://www.gnu.org/s/social/" class=LURL target=_top>https://www.gnu.org/s/social/</a></li></ul></div></div></div>

<div class="CClass"><div class=CTopic><h2 class=CTitle><a name="File"></a>File</h2><div class=CBody><p>A superclass containing the database representation of a file attatchment and the related interfaces.</p><h4 class=CHeading>Property</h4><ul><li>__table   - &lsquo;file&rsquo;;                            // table name</li><li>id        - int(4)  primary_key not_null</li><li>urlhash   - varchar(64)  unique_key</li><li>url       - text</li><li>filehash  - varchar(64)     indexed</li><li>mimetype  - varchar(50)</li><li>size      - int(4)</li><li>title     - text()</li><li>date      - int(4)</li><li>protected - int(4)</li><li>filename  - text()</li><li>width     - int(4)</li><li>height    - int(4)</li><li>modified  - timestamp()   not_null default_CURRENT_TIMESTAMP</li></ul><!--START_ND_SUMMARY--><div class=Summary><div class=STitle>Summary</div><div class=SBorder><table border=0 cellspacing=0 cellpadding=0 class=STable><tr class="SFunction"><td class=SEntry><a href="#File.schemaDef" id=link33 onMouseOver="ShowTip(event, 'tt1', 'link33')" onMouseOut="HideTip('tt1')">schemaDef</a></td><td class=SDescription>Returns an array representing the database schema this class is interfacing with.</td></tr><tr class="SFunction SMarked"><td class=SEntry><a href="#File.isProtected" id=link34 onMouseOver="ShowTip(event, 'tt2', 'link34')" onMouseOut="HideTip('tt2')">isProtected</a></td><td class=SDescription>Returns true/false whether the URL is considered &ldquo;protected&rdquo;.</td></tr><tr class="SFunction"><td class=SEntry><a href="#File.saveNew" id=link35 onMouseOver="ShowTip(event, 'tt3', 'link35')" onMouseOut="HideTip('tt3')">saveNew</a></td><td class=SDescription>Save a new file record.</td></tr><tr class="SFunction SMarked"><td class=SEntry><a href="#File.saveFile" id=link36 onMouseOver="ShowTip(event, 'tt4', 'link36')" onMouseOut="HideTip('tt4')">saveFile</a></td><td class=SDescription>This slightly-misleadingly named function saves the File record to the database, for actually creating a new file properly, see saveNew.</td></tr><tr class="SFunction"><td class=SEntry><a href="#File.processNew" id=link37 onMouseOver="ShowTip(event, 'tt5', 'link37')" onMouseOut="HideTip('tt5')">processNew</a></td><td class=SDescription></td></tr><tr class="SFunction SMarked"><td class=SEntry><a href="#File.respectsQuota" id=link38 onMouseOver="ShowTip(event, 'tt6', 'link38')" onMouseOut="HideTip('tt6')">respectsQuota</a></td><td class=SDescription>Tests whether a new upload respects the various quotas set in the instance configuration.</td></tr><tr class="SFunction"><td class=SEntry><a href="#File.getFilename" id=link39 onMouseOver="ShowTip(event, 'tt7', 'link39')" onMouseOut="HideTip('tt7')">getFilename</a></td><td class=SDescription>Returns the filename for the file represented by this File object.</td></tr><tr class="SFunction SMarked"><td class=SEntry><a href="#File.getSize" id=link40 onMouseOver="ShowTip(event, 'tt8', 'link40')" onMouseOut="HideTip('tt8')">getSize</a></td><td class=SDescription>Returns the filesize as reported by the system for the file.</td></tr><tr class="SFunction"><td class=SEntry><a href="#File.filename" id=link41 onMouseOver="ShowTip(event, 'tt9', 'link41')" onMouseOut="HideTip('tt9')">filename</a></td><td class=SDescription>Construct the filename for a new File object. </td></tr><tr class="SFunction SMarked"><td class=SEntry><a href="#File.guessMimeExtension" id=link42 onMouseOver="ShowTip(event, 'tt10', 'link42')" onMouseOut="HideTip('tt10')">guessMimeExtension</a></td><td class=SDescription>Attempt to determine the mime extension for the file represented by this File object. </td></tr><tr class="SFunction"><td class=SEntry><a href="#File.validFilename" id=link43 onMouseOver="ShowTip(event, 'tt11', 'link43')" onMouseOut="HideTip('tt11')">validFilename</a></td><td class=SDescription>Returns true/false whether the filename is a valid Linux filename.</td></tr><tr class="SFunction SMarked"><td class=SEntry><a href="#File.tryFilename" id=link44 onMouseOver="ShowTip(event, 'tt12', 'link44')" onMouseOut="HideTip('tt12')">tryFilename</a></td><td class=SDescription></td></tr><tr class="SFunction"><td class=SEntry><a href="#File.path" id=link45 onMouseOver="ShowTip(event, 'tt13', 'link45')" onMouseOut="HideTip('tt13')">path</a></td><td class=SDescription>Constructs the path for a given $filename based on site configuration.</td></tr><tr class="SFunction SMarked"><td class=SEntry><a href="#File.url" id=link46 onMouseOver="ShowTip(event, 'tt14', 'link46')" onMouseOut="HideTip('tt14')">url</a></td><td class=SDescription>Constructs the URL for a file entry.</td></tr><tr class="SFunction"><td class=SEntry><a href="#File.getEnclosure" id=link47 onMouseOver="ShowTip(event, 'tt15', 'link47')" onMouseOut="HideTip('tt15')">getEnclosure</a></td><td class=SDescription>Return the mime enclosure for a file.</td></tr><tr class="SFunction SMarked"><td class=SEntry><a href="#File.hasThumbnail" id=link48 onMouseOver="ShowTip(event, 'tt16', 'link48')" onMouseOut="HideTip('tt16')">hasThumbnail</a></td><td class=SDescription>Returns true/false whether this attachment has a thumbnail on record.</td></tr><tr class="SFunction"><td class=SEntry><a href="#File.getThumbnail" id=link49 onMouseOver="ShowTip(event, 'tt17', 'link49')" onMouseOut="HideTip('tt17')">getThumbnail</a></td><td class=SDescription>Get the attachment&rsquo;s thumbnail record, if any. </td></tr><tr class="SFunction SMarked"><td class=SEntry><a href="#File.getPath" id=link50 onMouseOver="ShowTip(event, 'tt18', 'link50')" onMouseOut="HideTip('tt18')">getPath</a></td><td class=SDescription>Returns the local filesystem path to a file we have stored locally.</td></tr><tr class="SFunction"><td class=SEntry><a href="#File.getAttachmentUrl" id=link51 onMouseOver="ShowTip(event, 'tt19', 'link51')" onMouseOut="HideTip('tt19')">getAttachmentUrl</a></td><td class=SDescription></td></tr><tr class="SFunction SMarked"><td class=SEntry><a href="#File.getUrl" id=link52 onMouseOver="ShowTip(event, 'tt20', 'link52')" onMouseOut="HideTip('tt20')">getUrl</a></td><td class=SDescription></td></tr><tr class="SFunction"><td class=SEntry><a href="#File.getByUrl" id=link53 onMouseOver="ShowTip(event, 'tt21', 'link53')" onMouseOut="HideTip('tt21')">getByUrl</a></td><td class=SDescription>Retrieve a File object by looking up its URL.</td></tr><tr class="SFunction SMarked"><td class=SEntry><a href="#File.getByHash" id=link54 onMouseOver="ShowTip(event, 'tt22', 'link54')" onMouseOut="HideTip('tt22')">getByHash</a></td><td class=SDescription>Retrieve a File object by looking up its hash.</td></tr><tr class="SFunction"><td class=SEntry><a href="#File.updateUrl" id=link55 onMouseOver="ShowTip(event, 'tt23', 'link55')" onMouseOut="HideTip('tt23')">updateUrl</a></td><td class=SDescription></td></tr><tr class="SFunction SMarked"><td class=SEntry><a href="#File.blowCache" id=link56 onMouseOver="ShowTip(event, 'tt24', 'link56')" onMouseOut="HideTip('tt24')">blowCache</a></td><td class=SDescription>Blow the cache of notices that link to this URL</td></tr><tr class="SFunction"><td class=SEntry><a href="#File.stream" id=link57 onMouseOver="ShowTip(event, 'tt25', 'link57')" onMouseOut="HideTip('tt25')">stream</a></td><td class=SDescription>Stream of notices linking to this URL or attachment</td></tr><tr class="SFunction SMarked"><td class=SEntry><a href="#File.noticeCount" id=link58 onMouseOver="ShowTip(event, 'tt26', 'link58')" onMouseOut="HideTip('tt26')">noticeCount</a></td><td class=SDescription>Returns how many notices use this attachment. </td></tr><tr class="SFunction"><td class=SEntry><a href="#File.isLocal" id=link59 onMouseOver="ShowTip(event, 'tt27', 'link59')" onMouseOut="HideTip('tt27')">isLocal</a></td><td class=SDescription>Returns whether we have a local copy of this file in the filesystem.</td></tr><tr class="SFunction SMarked"><td class=SEntry><a href="#File.delete" id=link60 onMouseOver="ShowTip(event, 'tt28', 'link60')" onMouseOut="HideTip('tt28')">delete</a></td><td class=SDescription>Remove an attachment entry from the DB and the associated file if stored locally. </td></tr><tr class="SFunction"><td class=SEntry><a href="#File.getTitle" id=link61 onMouseOver="ShowTip(event, 'tt29', 'link61')" onMouseOut="HideTip('tt29')">getTitle</a></td><td class=SDescription>Retrieves the title of an attachment entry, or if none is set, the filename.</td></tr><tr class="SFunction SMarked"><td class=SEntry><a href="#File.setTitle" id=link62 onMouseOver="ShowTip(event, 'tt30', 'link62')" onMouseOut="HideTip('tt30')">setTitle</a></td><td class=SDescription>Set the title of the attachment object.</td></tr><tr class="SFunction"><td class=SEntry><a href="#File.hashurl" id=link63 onMouseOver="ShowTip(event, 'tt31', 'link63')" onMouseOut="HideTip('tt31')">hashurl</a></td><td class=SDescription>Hash a URL provided using our given hash algorithm.</td></tr><tr class="SFunction SMarked"><td class=SEntry><a href="#File.beforeSchemaUpdate" id=link64 onMouseOver="ShowTip(event, 'tt32', 'link64')" onMouseOut="HideTip('tt32')">beforeSchemaUpdate</a></td><td class=SDescription>This procedure contains the various integrity checks we need to perform for the attachment system specifically.</td></tr></table></div></div><!--END_ND_SUMMARY--></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="File.schemaDef"></a>schemaDef</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td>public static function schemaDef()</td></tr></table></blockquote><p>Returns an array representing the database schema this class is interfacing with.</p></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="File.isProtected"></a>isProtected</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>public static function isProtected(</td><td class=PParameter nowrap>$url</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote><p>Returns true/false whether the URL is considered &ldquo;protected&rdquo;.</p><p>FIXME: un-hardcode this, or at the very least, make it configurable.</p></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="File.saveNew"></a>saveNew</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>public static function saveNew(</td><td class=PType nowrap>array&nbsp;</td><td class=PParameter nowrap>$redir_data,</td></tr><tr><td></td><td class=PType nowrap>&nbsp;</td><td class=PParameter nowrap>$given_url</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote><p>Save a new file record.</p><h4 class=CHeading>Parameters</h4><ul><li>array $redir_data lookup data eg from File_redirection::where()</li><li>string $given_url</li></ul><h4 class=CHeading>Returns</h4><ul><li>File class representing the saved file</li></ul><p>FIXME: we should probably give at least some debug-level feedback if we receive a link to a file that is our own allegedly, but we do not have the file available locally.</p></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="File.saveFile"></a>saveFile</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td>public function saveFile()</td></tr></table></blockquote><p>This slightly-misleadingly named function saves the File record to the database, for actually creating a new file properly, see saveNew.</p></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="File.processNew"></a>processNew</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>public static function processNew(</td><td class=PType nowrap>&nbsp;</td><td class=PParameter nowrap>$given_url,</td><td class=PDefaultValuePrefix>&nbsp;&nbsp;</td><td class=PDefaultValue width=100%></td></tr><tr><td></td><td class=PType nowrap>Notice&nbsp;</td><td class=PParameter nowrap>$notice</td><td class=PDefaultValuePrefix>&nbsp;=&nbsp;</td><td class=PDefaultValue width=100%>null,</td></tr><tr><td></td><td class=PType nowrap>&nbsp;</td><td class=PParameter nowrap>$followRedirects</td><td class=PDefaultValuePrefix>&nbsp;=&nbsp;</td><td class=PDefaultValue width=100%>true</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote><h4 class=CHeading>Go look at a URL and possibly save data about it if it&rsquo;s new</h4><ul><li>follow redirect chains and store them in file_redirection</li><li>if a thumbnail is available, save it in file_thumbnail</li><li>save file record with basic info</li><li>optionally save a file_to_post record</li><li>return the File object with the full reference</li></ul><h4 class=CHeading>Parameters</h4><ul><li>string $given_url the URL we&rsquo;re looking at</li><li>Notice $notice (optional)</li><li>bool $followRedirects defaults to true</li></ul><h4 class=CHeading>Returns</h4><ul><li>mixed File on success, -1 on some errors</li></ul><p>@throws ServerException on failure</p></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="File.respectsQuota"></a>respectsQuota</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>public static function respectsQuota(</td><td class=PType nowrap>Profile&nbsp;</td><td class=PParameter nowrap>$scoped,</td></tr><tr><td></td><td class=PType nowrap>&nbsp;</td><td class=PParameter nowrap>$fileSize</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote><p>Tests whether a new upload respects the various quotas set in the instance configuration.</p><h4 class=CHeading>Parameters</h4><ul><li>Profile scoped</li><li>fileSize</li></ul></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="File.getFilename"></a>getFilename</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td>public function getFilename()</td></tr></table></blockquote><p>Returns the filename for the file represented by this File object.</p></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="File.getSize"></a>getSize</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td>public function getSize()</td></tr></table></blockquote><p>Returns the filesize as reported by the system for the file.</p></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="File.filename"></a>filename</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>static function filename(</td><td class=PType nowrap>Profile&nbsp;</td><td class=PParameter nowrap>$profile,</td></tr><tr><td></td><td class=PType nowrap>&nbsp;</td><td class=PParameter nowrap>$origname,</td></tr><tr><td></td><td class=PType nowrap>&nbsp;</td><td class=PParameter nowrap>$mimetype</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote><p>Construct the filename for a new File object.&nbsp;  Returns the constructed filename.</p></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="File.guessMimeExtension"></a>guessMimeExtension</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>static function guessMimeExtension(</td><td class=PParameter nowrap>$mimetype,</td><td class=PDefaultValuePrefix>&nbsp;&nbsp;</td><td class=PDefaultValue width=100%></td></tr><tr><td></td><td class=PParameter nowrap>$filename</td><td class=PDefaultValuePrefix>&nbsp;=&nbsp;</td><td class=PDefaultValue width=100%>null</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote><p>Attempt to determine the mime extension for the file represented by this File object.&nbsp;  Returns the match on success.</p><h4 class=CHeading>Parameters</h4><ul><li>$mimetype - The mimetype we&rsquo;ve discovered for this file.</li><li>$filename - An optional filename which we can use on failure.</li></ul></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="File.validFilename"></a>validFilename</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>static function validFilename(</td><td class=PParameter nowrap>$filename</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote><p>Returns true/false whether the filename is a valid Linux filename.</p></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="File.tryFilename"></a>tryFilename</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>static function tryFilename(</td><td class=PParameter nowrap>$filename</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote><table border=0 cellspacing=0 cellpadding=0 class=CDescriptionList><tr><td class=CDLEntry>Sees if a given $filename is a valid filename</td><td class=CDLDescription>raises InvalidFilenameException on failure, true on success.</td></tr></table><p>FIXME: since this is being called elsewhere, shouldn&rsquo;t this return false on failure?</p></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="File.path"></a>path</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>static function path(</td><td class=PParameter nowrap>$filename</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote><p>Constructs the path for a given $filename based on site configuration.</p><h4 class=CHeading>Error States</h4><ul><li>ClientException on invalid filename</li></ul></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="File.url"></a>url</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>static function url(</td><td class=PParameter nowrap>$filename</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote><p>Constructs the URL for a file entry.</p></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="File.getEnclosure"></a>getEnclosure</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td>function getEnclosure()</td></tr></table></blockquote><p>Return the mime enclosure for a file.</p></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="File.hasThumbnail"></a>hasThumbnail</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td>public function hasThumbnail()</td></tr></table></blockquote><p>Returns true/false whether this attachment has a thumbnail on record.</p></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="File.getThumbnail"></a>getThumbnail</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>public function getThumbnail(</td><td class=PParameter nowrap>$width</td><td class=PDefaultValuePrefix>&nbsp;=&nbsp;</td><td class=PDefaultValue width=100%>null,</td></tr><tr><td></td><td class=PParameter nowrap>$height</td><td class=PDefaultValuePrefix>&nbsp;=&nbsp;</td><td class=PDefaultValue width=100%>null,</td></tr><tr><td></td><td class=PParameter nowrap>$crop</td><td class=PDefaultValuePrefix>&nbsp;=&nbsp;</td><td class=PDefaultValue width=100%>false,</td></tr><tr><td></td><td class=PParameter nowrap>$force_still</td><td class=PDefaultValuePrefix>&nbsp;=&nbsp;</td><td class=PDefaultValue width=100%>true,</td></tr><tr><td></td><td class=PParameter nowrap>$upscale</td><td class=PDefaultValuePrefix>&nbsp;=&nbsp;</td><td class=PDefaultValue width=100%>null</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote><p>Get the attachment&rsquo;s thumbnail record, if any.&nbsp; Make sure you supply proper &lsquo;int&rsquo; typed variables (or null).</p><h4 class=CHeading>Parameters</h4><ul><li>integer width        - Max width of thumbnail in pixels.&nbsp; (if null, use common_config values)</li><li>integer height       - Max height of thumbnail in pixels.&nbsp; (if null, square-crop to $width)</li><li>boolean crop         - Crop to the max-values&rsquo; aspect ratio</li><li>boolean $force_still - Don&rsquo;t allow fallback to showing original (such as animated GIF)</li><li>mixed $upscale       - Whether or not to scale smaller images up to larger thumbnail sizes.&nbsp; (null = site default)</li></ul><h4 class=CHeading>Returns</h4><ul><li>File_thumbnail object representing the thumbnail</li></ul><h4 class=CHeading>Error States</h4><ul><li>UseFileAsThumbnailException - if the file is considered an image itself and should be itself as thumbnail</li><li>UnsupportedMediaException   - if, despite trying, we can&rsquo;t understand how to make a thumbnail for this format</li><li>ServerException             - on various other errors</li></ul></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="File.getPath"></a>getPath</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td>public function getPath()</td></tr></table></blockquote><p>Returns the local filesystem path to a file we have stored locally.</p></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="File.getAttachmentUrl"></a>getAttachmentUrl</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td>public function getAttachmentUrl()</td></tr></table></blockquote><table border=0 cellspacing=0 cellpadding=0 class=CDescriptionList><tr><td class=CDLEntry>Returns the local URL of an attachment</td><td class=CDLDescription>obviously, this needs to be a locally-stored one but this won&rsquo;t be checked here.</td></tr></table></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="File.getUrl"></a>getUrl</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>public function getUrl(</td><td class=PParameter nowrap>$use_local</td><td class=PDefaultValuePrefix>&nbsp;=&nbsp;</td><td class=PDefaultValue width=100%>null</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote><table border=0 cellspacing=0 cellpadding=0 class=CDescriptionList><tr><td class=CDLEntry>Returns the URL of the File object</td><td class=CDLDescription>the filename if it&rsquo;s local, otherwise just the stored URL.</td></tr></table><h4 class=CHeading>Parameters</h4><ul><li>mixed  $use_local - true means require local, null means prefer local, false means use whatever is stored</li></ul></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="File.getByUrl"></a>getByUrl</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>static public function getByUrl(</td><td class=PParameter nowrap>$url</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote><p>Retrieve a File object by looking up its URL.</p><h4 class=CHeading>Parameters</h4><ul><li>string url</li></ul></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="File.getByHash"></a>getByHash</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>static public function getByHash(</td><td class=PParameter nowrap>$hashstr</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote><p>Retrieve a File object by looking up its hash.</p><h4 class=CHeading>Parameters</h4><ul><li>string $hashstr - String of (preferrably lower case) hexadecimal characters, same as result of &lsquo;hash_file(...)&rsquo;</li></ul></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="File.updateUrl"></a>updateUrl</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>public function updateUrl(</td><td class=PParameter nowrap>$url</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote><table border=0 cellspacing=0 cellpadding=0 class=CDescriptionList><tr><td class=CDLEntry>Update an attachment</td><td class=CDLDescription>note, this will throw an exception if it hasn&rsquo;t changed, which may not be expected behaviour in all control paths.</td></tr></table></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="File.blowCache"></a>blowCache</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>function blowCache(</td><td class=PParameter nowrap>$last</td><td class=PDefaultValuePrefix>&nbsp;=&nbsp;</td><td class=PDefaultValue width=100%>false</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote><p>Blow the cache of notices that link to this URL</p><h4 class=CHeading>Parameters</h4><ul><li>boolean $last Whether to blow the &ldquo;last&rdquo; cache too</li></ul><h4 class=CHeading>Returns</h4><ul><li>void</li></ul></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="File.stream"></a>stream</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>function stream(</td><td class=PParameter nowrap>$offset</td><td class=PDefaultValuePrefix>&nbsp;=&nbsp;</td><td class=PDefaultValue width=100%>0,</td></tr><tr><td></td><td class=PParameter nowrap>$limit</td><td class=PDefaultValuePrefix>&nbsp;=&nbsp;</td><td class=PDefaultValue width=100%>NOTICES_PER_PAGE,</td></tr><tr><td></td><td class=PParameter nowrap>$since_id</td><td class=PDefaultValuePrefix>&nbsp;=&nbsp;</td><td class=PDefaultValue width=100%>0,</td></tr><tr><td></td><td class=PParameter nowrap>$max_id</td><td class=PDefaultValuePrefix>&nbsp;=&nbsp;</td><td class=PDefaultValue width=100%>0</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote><p>Stream of notices linking to this URL or attachment</p><ul><li>integer $offset   Offset to show; default is 0</li><li>integer $limit    Limit of notices to show</li><li>integer $since_id Since this notice</li><li>integer $max_id   Before this notice</li></ul><h4 class=CHeading>Returns</h4><ul><li>array ids of notices that link to this file</li></ul><p>FIXME: Try to get the Profile::current() here in some other way to avoid mixing the current session user with possibly background/queue processing.</p></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="File.noticeCount"></a>noticeCount</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td>function noticeCount()</td></tr></table></blockquote><p>Returns how many notices use this attachment.&nbsp;  Good for finding orphaned files.</p></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="File.isLocal"></a>isLocal</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td>public function isLocal()</td></tr></table></blockquote><p>Returns whether we have a local copy of this file in the filesystem.</p></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="File.delete"></a>delete</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>public function delete(</td><td class=PParameter nowrap>$useWhere</td><td class=PDefaultValuePrefix>&nbsp;=&nbsp;</td><td class=PDefaultValue width=100%>false</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote><p>Remove an attachment entry from the DB and the associated file if stored locally.&nbsp;  Also cleans out thumbnails in the case of visual media.</p></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="File.getTitle"></a>getTitle</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td>public function getTitle()</td></tr></table></blockquote><p>Retrieves the title of an attachment entry, or if none is set, the filename.</p></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="File.setTitle"></a>setTitle</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>public function setTitle(</td><td class=PParameter nowrap>$title</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote><p>Set the title of the attachment object.</p></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="File.hashurl"></a>hashurl</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>static public function hashurl(</td><td class=PParameter nowrap>$url</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote><p>Hash a URL provided using our given hash algorithm.</p></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="File.beforeSchemaUpdate"></a>beforeSchemaUpdate</h3><div class=CBody><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td>static public function beforeSchemaUpdate()</td></tr></table></blockquote><p>This procedure contains the various integrity checks we need to perform for the attachment system specifically.</p></div></div></div>

</div><!--Content-->



<!--START_ND_TOOLTIPS-->
<div class=CToolTip id="tt1"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td>public static function schemaDef()</td></tr></table></blockquote>Returns an array representing the database schema this class is interfacing with.</div></div><div class=CToolTip id="tt2"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>public static function isProtected(</td><td class=PParameter nowrap>$url</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote>Returns true/false whether the URL is considered &ldquo;protected&rdquo;.</div></div><div class=CToolTip id="tt3"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>public static function saveNew(</td><td class=PType nowrap>array&nbsp;</td><td class=PParameter nowrap>$redir_data,</td></tr><tr><td></td><td class=PType nowrap>&nbsp;</td><td class=PParameter nowrap>$given_url</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote>Save a new file record.</div></div><div class=CToolTip id="tt4"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td>public function saveFile()</td></tr></table></blockquote>This slightly-misleadingly named function saves the File record to the database, for actually creating a new file properly, see saveNew.</div></div><div class=CToolTip id="tt5"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>public static function processNew(</td><td class=PType nowrap>&nbsp;</td><td class=PParameter nowrap>$given_url,</td><td class=PDefaultValuePrefix>&nbsp;&nbsp;</td><td class=PDefaultValue width=100%></td></tr><tr><td></td><td class=PType nowrap>Notice&nbsp;</td><td class=PParameter nowrap>$notice</td><td class=PDefaultValuePrefix>&nbsp;=&nbsp;</td><td class=PDefaultValue width=100%>null,</td></tr><tr><td></td><td class=PType nowrap>&nbsp;</td><td class=PParameter nowrap>$followRedirects</td><td class=PDefaultValuePrefix>&nbsp;=&nbsp;</td><td class=PDefaultValue width=100%>true</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote></div></div><div class=CToolTip id="tt6"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>public static function respectsQuota(</td><td class=PType nowrap>Profile&nbsp;</td><td class=PParameter nowrap>$scoped,</td></tr><tr><td></td><td class=PType nowrap>&nbsp;</td><td class=PParameter nowrap>$fileSize</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote>Tests whether a new upload respects the various quotas set in the instance configuration.</div></div><div class=CToolTip id="tt7"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td>public function getFilename()</td></tr></table></blockquote>Returns the filename for the file represented by this File object.</div></div><div class=CToolTip id="tt8"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td>public function getSize()</td></tr></table></blockquote>Returns the filesize as reported by the system for the file.</div></div><div class=CToolTip id="tt9"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>static function filename(</td><td class=PType nowrap>Profile&nbsp;</td><td class=PParameter nowrap>$profile,</td></tr><tr><td></td><td class=PType nowrap>&nbsp;</td><td class=PParameter nowrap>$origname,</td></tr><tr><td></td><td class=PType nowrap>&nbsp;</td><td class=PParameter nowrap>$mimetype</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote>Construct the filename for a new File object. </div></div><div class=CToolTip id="tt10"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>static function guessMimeExtension(</td><td class=PParameter nowrap>$mimetype,</td><td class=PDefaultValuePrefix>&nbsp;&nbsp;</td><td class=PDefaultValue width=100%></td></tr><tr><td></td><td class=PParameter nowrap>$filename</td><td class=PDefaultValuePrefix>&nbsp;=&nbsp;</td><td class=PDefaultValue width=100%>null</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote>Attempt to determine the mime extension for the file represented by this File object. </div></div><div class=CToolTip id="tt11"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>static function validFilename(</td><td class=PParameter nowrap>$filename</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote>Returns true/false whether the filename is a valid Linux filename.</div></div><div class=CToolTip id="tt12"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>static function tryFilename(</td><td class=PParameter nowrap>$filename</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote></div></div><div class=CToolTip id="tt13"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>static function path(</td><td class=PParameter nowrap>$filename</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote>Constructs the path for a given $filename based on site configuration.</div></div><div class=CToolTip id="tt14"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>static function url(</td><td class=PParameter nowrap>$filename</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote>Constructs the URL for a file entry.</div></div><div class=CToolTip id="tt15"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td>function getEnclosure()</td></tr></table></blockquote>Return the mime enclosure for a file.</div></div><div class=CToolTip id="tt16"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td>public function hasThumbnail()</td></tr></table></blockquote>Returns true/false whether this attachment has a thumbnail on record.</div></div><div class=CToolTip id="tt17"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>public function getThumbnail(</td><td class=PParameter nowrap>$width</td><td class=PDefaultValuePrefix>&nbsp;=&nbsp;</td><td class=PDefaultValue width=100%>null,</td></tr><tr><td></td><td class=PParameter nowrap>$height</td><td class=PDefaultValuePrefix>&nbsp;=&nbsp;</td><td class=PDefaultValue width=100%>null,</td></tr><tr><td></td><td class=PParameter nowrap>$crop</td><td class=PDefaultValuePrefix>&nbsp;=&nbsp;</td><td class=PDefaultValue width=100%>false,</td></tr><tr><td></td><td class=PParameter nowrap>$force_still</td><td class=PDefaultValuePrefix>&nbsp;=&nbsp;</td><td class=PDefaultValue width=100%>true,</td></tr><tr><td></td><td class=PParameter nowrap>$upscale</td><td class=PDefaultValuePrefix>&nbsp;=&nbsp;</td><td class=PDefaultValue width=100%>null</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote>Get the attachment&rsquo;s thumbnail record, if any. </div></div><div class=CToolTip id="tt18"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td>public function getPath()</td></tr></table></blockquote>Returns the local filesystem path to a file we have stored locally.</div></div><div class=CToolTip id="tt19"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td>public function getAttachmentUrl()</td></tr></table></blockquote></div></div><div class=CToolTip id="tt20"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>public function getUrl(</td><td class=PParameter nowrap>$use_local</td><td class=PDefaultValuePrefix>&nbsp;=&nbsp;</td><td class=PDefaultValue width=100%>null</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote></div></div><div class=CToolTip id="tt21"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>static public function getByUrl(</td><td class=PParameter nowrap>$url</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote>Retrieve a File object by looking up its URL.</div></div><div class=CToolTip id="tt22"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>static public function getByHash(</td><td class=PParameter nowrap>$hashstr</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote>Retrieve a File object by looking up its hash.</div></div><div class=CToolTip id="tt23"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>public function updateUrl(</td><td class=PParameter nowrap>$url</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote></div></div><div class=CToolTip id="tt24"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>function blowCache(</td><td class=PParameter nowrap>$last</td><td class=PDefaultValuePrefix>&nbsp;=&nbsp;</td><td class=PDefaultValue width=100%>false</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote>Blow the cache of notices that link to this URL</div></div><div class=CToolTip id="tt25"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>function stream(</td><td class=PParameter nowrap>$offset</td><td class=PDefaultValuePrefix>&nbsp;=&nbsp;</td><td class=PDefaultValue width=100%>0,</td></tr><tr><td></td><td class=PParameter nowrap>$limit</td><td class=PDefaultValuePrefix>&nbsp;=&nbsp;</td><td class=PDefaultValue width=100%>NOTICES_PER_PAGE,</td></tr><tr><td></td><td class=PParameter nowrap>$since_id</td><td class=PDefaultValuePrefix>&nbsp;=&nbsp;</td><td class=PDefaultValue width=100%>0,</td></tr><tr><td></td><td class=PParameter nowrap>$max_id</td><td class=PDefaultValuePrefix>&nbsp;=&nbsp;</td><td class=PDefaultValue width=100%>0</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote>Stream of notices linking to this URL or attachment</div></div><div class=CToolTip id="tt26"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td>function noticeCount()</td></tr></table></blockquote>Returns how many notices use this attachment. </div></div><div class=CToolTip id="tt27"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td>public function isLocal()</td></tr></table></blockquote>Returns whether we have a local copy of this file in the filesystem.</div></div><div class=CToolTip id="tt28"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>public function delete(</td><td class=PParameter nowrap>$useWhere</td><td class=PDefaultValuePrefix>&nbsp;=&nbsp;</td><td class=PDefaultValue width=100%>false</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote>Remove an attachment entry from the DB and the associated file if stored locally. </div></div><div class=CToolTip id="tt29"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td>public function getTitle()</td></tr></table></blockquote>Retrieves the title of an attachment entry, or if none is set, the filename.</div></div><div class=CToolTip id="tt30"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>public function setTitle(</td><td class=PParameter nowrap>$title</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote>Set the title of the attachment object.</div></div><div class=CToolTip id="tt31"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td><table border=0 cellspacing=0 cellpadding=0><tr><td class=PBeforeParameters nowrap>static public function hashurl(</td><td class=PParameter nowrap>$url</td><td class=PAfterParameters nowrap>)</td></tr></table></td></tr></table></blockquote>Hash a URL provided using our given hash algorithm.</div></div><div class=CToolTip id="tt32"><div class=CFunction><blockquote><table border=0 cellspacing=0 cellpadding=0 class=Prototype><tr><td>static public function beforeSchemaUpdate()</td></tr></table></blockquote>This procedure contains the various integrity checks we need to perform for the attachment system specifically.</div></div><!--END_ND_TOOLTIPS-->

<script language=JavaScript><!--
if (browserType) {if (browserVer) {document.write("</div>"); }document.write("</div>");}// --></script></body></html>